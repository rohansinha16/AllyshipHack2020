Code is pretty rough, but it works, will clean it up later and add more documentation.
